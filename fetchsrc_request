#!/bin/sh
# $Id$
#
# Sending via 
VIA="SENDMAIL"
#VIA="localhost"
#
# DISTFILES EMAIL
DMAIL="distfiles@pld-linux.org"
#
# CVS LOGIN or fill it by hand :)
LOGIN=`cat CVS/Root | awk -F: '{ print $3; }' | perl -pi -e "s/@.+//"`
#LOGIN="djrzulf"
#
# HOST
HOST=`hostname -f`
#HOST="knycz.net"
#
# functions

usage()
{
	echo "\
Usage: fetchsrc_request file.spec [BRANCH]
"
}

#------------------
# main()
if [ "$#" = 0 ]; then
	usage;
	exit 1
fi
if [ "$2" != "" ]; then
	BRANCH="$2"
else
	BRANCH="HEAD"
fi

if [ "$VIA" = "SENDMAIL" ]; then
	MAIL="To: $DMAIL\nFrom: $LOGIN <$LOGIN@$HOST>\nSubject: cvs to df notify\nX-CVS-Module: SPECS\nX-distfiles-request: yes\nX-Login: $LOGIN\nX-Spec: $1\nX-Branch:	$BRANCH\nX-Flags: force-reply\n.\n"
	echo -e $MAIL | /usr/sbin/sendmail -t
else
	MAIL="EHLO $HOST\nMAIL FROM: $LOGIN <$LOGIN@$HOST>\nRCPT TO: $DMAIL\nDATA\nSubject: cvs to df notify\nX-CVS-Module: SPECS\nX-distfiles-request: yes\nX-Login: $LOGIN\nX-Spec: $1\nX-Branch:$BRANCH\nX-Flags: force-reply\n.\nQUIT\n"
	echo -e $MAIL | /usr/bin/nc $VIA 25
fi

